name: {{project_name}}

packages:
  - app/*
  - core/*
  - feature/*

command:
  bootstrap:
    runPubGetInParallel: false

    environment:
      sdk: ">=3.0.0 <4.0.0"
      flutter: ">=3.0.0 <4.0.0"

    dependencies:
      collection: ^1.18.0
      flow_builder: ^0.1.0
      go_router: ^14.2.0
      flutter_riverpod: ^2.5.1
      hooks_riverpod: ^2.5.1
      flutter_hooks: ^0.20.5
      riverpod_annotation: ^2.3.5
    
    dev_dependencies:
      flutter_lints: ^4.0.0
      build_runner: ^2.3.3
      go_router_builder: ^2.7.0
      riverpod_generator: ^2.4.2

scripts:
  build_all:
    run: dart pub global run melos exec --depends-on="build_runner" "flutter packages pub run build_runner build"
    description: build_runner build all modules.

  watch_all:
    run: dart pub global run melos exec --depends-on="build_runner" "flutter packages pub run build_runner watch"
    description: build_runner watch all modules.

  force_build_all:
    run: dart pub global run melos exec --depends-on="build_runner" "flutter packages pub run build_runner build --delete-conflicting-outputs"
    description: build_runner build all modules.

  force_watch_all:
    run: dart pub global run melos exec --depends-on="build_runner" "flutter packages pub run build_runner watch --delete-conflicting-outputs"
    description: build_runner watch all modules.
  
  pub_get_all:
    run: dart pub global run melos exec "flutter pub get"
    description: Run pub get on all modules.

  l10n:
    run: dart pub global run melos exec --fail-fast --scope="resources" --flutter "flutter pub run intl_utils:generate"
    description: Generates l10n for all app packages.

  test:
    run: dart pub global run melos exec --fail-fast --dir-exists="test" "flutter test"
    description: Run all tests.

  pub_upgrade:
    run: dart pub global run melos exec --fail-fast "flutter pub upgrade"
    description: Run pub upgrade on all module.

  format:
    run: dart pub global run melos exec --fail-fast --flutter -- "find . -name ".dart" ! -name ".g.dart" ! -name ".freezed.dart" ! -name ".gr.dart" ! -name ".config.dart" ! -name ".mocks.dart" ! -path '/generated/' ! -path '/.dart_tool/' | tr '\n' ' ' | xargs dart format --set-exit-if-changed -l 100"
    description: Run format.

  metrics:
    run: dart pub global run melos exec --flutter -- "flutter pub run dart_code_metrics:metrics analyze lib"
    description: Run metrics.

  analyze:
    run: dart pub global run melos exec --flutter -- "flutter analyze --no-pub --suppress-analytics"
    description: Run analyze.

  lint:
    run: dart pub global run melos run analyze && dart pub global run melos run metrics
    description: Run metrics and analyze.

  format_lint:
    run: dart pub global run melos run format && dart pub global run melos run lint
    description: Run format & analyze.

  test_coverage:
    run: dart pub global run melos exec --fail-fast --dir-exists="test" "flutter test --coverage && lcov --remove coverage/lcov.info '*/.freezed.dart' '*/.g.dart' '*/.graphql.dart' '*/.part.dart' '*/.config.dart' '*/_event.dart' '*/_state.dart' '*/generated/' '*/routes/' '*/l10n/' '*/config/' '*/di/' -o coverage/lcov.info && genhtml coverage/lcov.info --output=coverage && open coverage/index.html"
    description: Run test coverage.